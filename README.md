# WASH-PRO-PULSE

Проект представляет собой конвертер импульсов (pulse converter) на базе микроконтроллера **STM32F103C8T6**. Устройство предназначено для считывания кредитных импульсов с терминалов безналичной оплаты (эквайринга) и передачи данных на контроллер оборудования, например, на автомойке самообслуживания.

Код протестирован и применяется для подключения к контроллеру автомойки самообслуживания **WASH-PRO**.

## Назначение и функциональность

Основная задача устройства — интеграция современных платежных систем с оборудованием, управляемым по импульсному или проприетарному протоколу.

**Ключевые функции:**

1.  **Считывание импульсов:** Устройство настроено на считывание импульсов с логическими уровнями 3.3V от терминалов эквайринга, таких как **Vendista** и **Vendotek**. Для этого используется аппаратное прерывание на пине `PA0`.

2.  **Ручное добавление кредитов:** Реализована возможность добавления кредитов вручную с помощью двух кнопок:
    *   Кнопка на `PB12`: добавляет 10 кредитов.
    *   Кнопка на `PB13`: добавляет 50 кредитов.

3.  **Обмен данными:** Устройство общается с главным контроллером (например, WASH-PRO) по протоколу, частично повторяющему **"Эфор Онлайн"**, через UART (`PA9`/`PA10`). Оно отправляет пакеты с информацией о состоянии и количестве полученных кредитов.

4.  **Индикация состояния:** Два светодиода на пинах `PB14` и `PB15` используются для визуальной индикации работы и состояния устройства.

## Архитектура ПО

Прошивка написана с использованием **FreeRTOS**, что обеспечивает параллельное выполнение нескольких задач:

*   `TaskPulse`: Обработка входящих импульсов от платежного терминала.
*   `TaskButton`: Обработка нажатий кнопок для ручного добавления кредитов.
*   `TaskRoutine`: Управление основной логикой, состоянием и обменом данными с главным контроллером по UART.
*   `TaskIndication`: Управление светодиодной индикацией.

Такая многозадачная архитектура обеспечивает отзывчивость и надежность системы.

## Аппаратная часть

*   **Микроконтроллер:** STM32F103C8T6 ("Blue Pill").
*   **Интерфейсы:**
    *   `PA0`: Вход для импульсов от терминала эквайринга (INPUT_PULLUP).
    *   `PB12`, `PB13`: Входы для кнопок (INPUT_PULLUP).
    *   `PA9` (TX), `PA10` (RX): UART для связи с главным контроллером.
    *   `PB14`, `PB15`: Выходы для светодиодной индикации.

## Потенциальное применение

Хотя проект изначально создавался для автомоек WASH-PRO, его архитектура позволяет адаптировать его для использования с другими устройствами и системами, где требуется преобразование импульсных сигналов в данные для управляющего контроллера.
